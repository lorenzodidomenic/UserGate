### Schema includes ###########################################################
include                 /etc/ldap/schema/core.schema
include                 /etc/ldap/schema/cosine.schema
include                 /etc/ldap/schema/inetorgperson.schema
include                 /etc/ldap/schema/misc.schema
include                 /etc/ldap/schema/nis.schema
include                 /etc/ldap/schema/corba.schema
include                 /etc/ldap/schema/duaconf.schema
include                /etc/ldap/schema/dyngroup.schema
include                /etc/ldap/schema/java.schema
include                /etc/ldap/schema/openldap.schema


## Module paths ##############################################################
modulepath              /usr/lib/ldap/
moduleload              back_ldap
moduleload              back_ldif
moduleload              back_mdb
moduleload              rwm
moduleload              /usr/lib/ldap/translucent.la
moduleload              /usr/lib/ldap/memberof.la
moduleload              /usr/lib/ldap/pcache.la
moduleload              back_monitor

# Main settings ###############################################################
pidfile                 /var/run/slapd/slapd.pid
argsfile                /var/run/slapd/slapd.args

database frontend

database monitor 

#database config
#access to *
 #   by dn.exact="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth" manage
  #  by * none

database config
rootdn "cn=admin,cn=config"
rootpw "palazzolo"

#database    mdb
#suffix      $SUFFIX   
#rootdn       $ROOT_DN 
#rootpw       $ROOT_PW  
#directory  /var/lib/ldap  
#index objectClass eq
#readonly off   
#access to attrs=userPassword    
 #   by self write
 #   by anonymous auth
 ##   by * none
#access to *   
   # by self write
   #by * read
#subordinate
#sizelimit 10000000
#sizelimit 50 il numero di entries che un client può richiedere (vedere soft e hard limits), default 500
overlay memberof

database mdb
suffix      "ou=Gruppi Studenti,dc=unict,dc=ad"
rootdn      "cn=admin,ou=Gruppi Studenti,dc=unict,dc=ad"
rootpw      $ROOT_PW
index objectClass eq   
readonly off  
directory  /var/lib/ldap
sizelimit 100000
overlay     translucent  
uri         $URI
lastmod off
idassert-bind   bindmethod=simple
                binddn="cn=DDMLNZ03B03F943C,ou=Studenti,dc=unict,dc=ad"
                credentials="Palazzolo3"
                mode=self
sizelimit 1000000 
access to dn.subtree="ou=Gruppi Studenti,dc=unict,dc=ad"  
       by dn.exact="cn=DDMLNZ03B03F943C,ou=Studenti,dc=unict,dc=ad" write 
subordinate


database    mdb
suffix      $SUFFIX_2
rootdn      $ROOT_DN2
rootpw      $ROOT_PW
maxsize     85899345920  
index objectClass eq   
readonly off  
directory  /var/lib/ldap
sizelimit 100000
subordinate
#rtnxsize  specifica il massimo numero di entries da processare in una singola lettura quando esrguiamo una grande ricerca. default 10000

overlay rwm
rwm-map attribute memberOfGroup memberOf  

#qui metto overlay member of e in local metto overlay member
overlay memberof 
#note that member of is an operation attribute, so it must be requested explicitly
#aggiungo nuovo attributo allo schema
overlay     translucent  
translucent_local $LOCAL_ATTRIBUTES
#translucent_remote cn
translucent_remote member,memberOf
uri         $URI
lastmod     off
idassert-bind   bindmethod=simple
                binddn="cn=DDMLNZ03B03F943C,ou=Studenti,dc=unict,dc=ad"
                credentials="Palazzolo3"
                mode=self
sizelimit 1000000 
access to dn.subtree="ou=Studenti,dc=unict,dc=ad"  
       by dn.exact="cn=DDMLNZ03B03F943C,ou=Studenti,dc=unict,dc=ad" write 
subordinate
#idassert-bind   bindmethod=simplecd ..
               # binddn="cn=DDMLNZ03B03F943C,ou=Studenti,dc=unict,dc=ad"
              # credentials="Palazzolo3"
               # mode=self

database mdb
suffix "dc=unict,dc=ad"
readonly off
rootdn      "cn=admin,dc=unict,dc=ad"
rootpw      $ROOT_PW
sizelimit 100000
access to dn.subtree="ou=Gruppi Locali,dc=unict,dc=ad"
       by dn.exact="cn=DDMLNZ03B03F943C,ou=Studenti,dc=unict,dc=ad" write
access to dn.subtree="ou=Studenti Locali,dc=unict,dc=ad"
       by dn.exact="cn=DDMLNZ03B03F943C,ou=Studenti,dc=unict,dc=ad" write
overlay memberof

#IN QUESTO MOMENTO L'UNICO CHE PUò LEGGERE E ESCRIVERE è L'ADMIN GRAZIE AD ID-ASSERT BIND E IO
#GLI ALTRI STUDENTI POSSO CERCARE GLI STUDENTI MA NON VEDERE I POSSIBILI GRUPPI 

#write da anche permessi di lettura, quindi in questo momento posso anche leggere
#access to dn.subtree="ou=Gruppi Locali,dc=unict,dc=ad"        
   #by dn.subtree="ou=Studenti,dc=unict,dc=ad" none
#devo aggiungere questi attributi nello schema
#overlay rwm
#rwm-map attribute carLicense memberOf  #qui dovrei mappare member of con localMemeberOf o remote member of
#rwm-map                 attribute       uid     sAMAccountName
#rwm-map        attribute lastName sn
#rwm-map        attribute  member member
#rwm-map        attribute uid sAMAccountname
#rwm-map        attribute member MEMBEROF

#acl-bind    binddn="cn=Administrator,ou=Students,dc=lorenzo,dc=dido,dc=it" credentials=“Palazzolo3@“


#access to dn.subtree="ou=Gruppi Locali,dc=unict,dc=ad"
  #by dn.exact="cn=DDMLNZ03B03F943C,ou=Studenti,dc=unict,dc=ad" write

#access to dn.subtree="ou=Studenti,dc=unict,dc=ad"  
 #  by dn.exact="cn=DDMLNZ03B03F943C,ou=Studenti,dc=unict,dc=ad" write  